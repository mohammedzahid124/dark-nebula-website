# Architecture Overview: State Machine Chatbot System

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERFACE LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   ChatBotRefactored  â”‚         â”‚  ContactAutofill     â”‚      â”‚
â”‚  â”‚   (Widget UI)        â”‚         â”‚  (Form UI)           â”‚      â”‚
â”‚  â”‚                      â”‚         â”‚                      â”‚      â”‚
â”‚  â”‚ - Floating button    â”‚         â”‚ - Auto-fill from     â”‚      â”‚
â”‚  â”‚ - Message display    â”‚         â”‚   URL params         â”‚      â”‚
â”‚  â”‚ - Progress bar       â”‚         â”‚ - Form validation    â”‚      â”‚
â”‚  â”‚ - Input field        â”‚         â”‚ - Success screen     â”‚      â”‚
â”‚  â”‚ - Typing indicator   â”‚         â”‚                      â”‚      â”‚
â”‚  â”‚ - Summary display    â”‚         â”‚                      â”‚      â”‚
â”‚  â”‚ - CTA button         â”‚         â”‚                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚             â”‚                                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                  â”‚
              â”‚ Hook Usage                       â”‚ URL Params
              â”‚                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STATE MANAGEMENT LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           useChatStateMachine Hook                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  States:                                                â”‚   â”‚
â”‚  â”‚  - messages: ChatMessage[]                             â”‚   â”‚
â”‚  â”‚  - leadData: LeadData                                  â”‚   â”‚
â”‚  â”‚  - currentStage: ChatStage                             â”‚   â”‚
â”‚  â”‚  - isLoading: boolean                                  â”‚   â”‚
â”‚  â”‚  - isTyping: boolean                                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Methods:                                               â”‚   â”‚
â”‚  â”‚  - initializeChat()          Init greeting             â”‚   â”‚
â”‚  â”‚  - processUserMessage()      Add message & advance     â”‚   â”‚
â”‚  â”‚  - validateForStage()        Check data validity       â”‚   â”‚
â”‚  â”‚  - getNextQuestion()         Get prompt text           â”‚   â”‚
â”‚  â”‚  - advanceToContactForm()    Build redirect URL        â”‚   â”‚
â”‚  â”‚  - resetChat()               Clear all data            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Utilities:                                             â”‚   â”‚
â”‚  â”‚  - progressPercentage: 0-100                           â”‚   â”‚
â”‚  â”‚  - currentStep: "Step X of Y"                          â”‚   â”‚
â”‚  â”‚  - lastBotMessageRef: prevent duplicates              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Persistence:                                           â”‚   â”‚
â”‚  â”‚  - saveChatState()           â†’ localStorage           â”‚   â”‚
â”‚  â”‚  - loadChatState()           â† localStorage           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                    â”‚
              â”‚ Type Safety                        â”‚ Utilities
              â”‚                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BUSINESS LOGIC LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   types/lead.ts      â”‚         â”‚ lib/lead-validation  â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ .ts                  â”‚     â”‚
â”‚  â”‚ Enums:               â”‚         â”‚                      â”‚     â”‚
â”‚  â”‚ - ChatStage (7)      â”‚         â”‚ Validators:          â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - validateEmail()    â”‚     â”‚
â”‚  â”‚ Interfaces:          â”‚         â”‚ - validatePhone()    â”‚     â”‚
â”‚  â”‚ - LeadData           â”‚         â”‚ - validateName()     â”‚     â”‚
â”‚  â”‚ - ValidationResult   â”‚         â”‚                      â”‚     â”‚
â”‚  â”‚ - ChatMessage        â”‚         â”‚ Extractors:          â”‚     â”‚
â”‚  â”‚ - PricingTier        â”‚         â”‚ - extractEmail()     â”‚     â”‚
â”‚  â”‚ - ProjectType        â”‚         â”‚ - extractPhone()     â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - extractName()      â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - detectPurpose()    â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - extractLeadData()  â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚                      â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ Utilities:           â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - getNextStage()     â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - isLeadComplete()   â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - getPricingFor()    â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ - buildLeadUrl()     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚             â”‚                                  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                  â”‚
              â”‚ API Contracts                    â”‚ Validation/Extraction
              â”‚                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  POST /api/chat                                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Request Body:                                          â”‚   â”‚
â”‚  â”‚  {                                                       â”‚   â”‚
â”‚  â”‚    message: string                                      â”‚   â”‚
â”‚  â”‚    conversationHistory: Message[]                       â”‚   â”‚
â”‚  â”‚    leadData: LeadData                                   â”‚   â”‚
â”‚  â”‚    currentStage: ChatStage                              â”‚   â”‚
â”‚  â”‚    systemPrompt?: string                                â”‚   â”‚
â”‚  â”‚  }                                                       â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Processing:                                            â”‚   â”‚
â”‚  â”‚  1. Trim history (max 6 messages)                       â”‚   â”‚
â”‚  â”‚  2. Build context message                              â”‚   â”‚
â”‚  â”‚  3. Call OpenAI API (gpt-3.5-turbo)                    â”‚   â”‚
â”‚  â”‚  4. Return response + metadata                          â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Response Body:                                         â”‚   â”‚
â”‚  â”‚  {                                                       â”‚   â”‚
â”‚  â”‚    reply: string                                        â”‚   â”‚
â”‚  â”‚    stage: ChatStage                                     â”‚   â”‚
â”‚  â”‚    leadData: LeadData                                   â”‚   â”‚
â”‚  â”‚    timestamp: string                                    â”‚   â”‚
â”‚  â”‚  }                                                       â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                                     â”‚
â”‚             â”‚ OpenAI API Call                                    â”‚
â”‚             â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  POST /api/lead                                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Request Body:                                          â”‚   â”‚
â”‚  â”‚  {                                                       â”‚   â”‚
â”‚  â”‚    name: string          (required)                     â”‚   â”‚
â”‚  â”‚    email: string         (required)                     â”‚   â”‚
â”‚  â”‚    phone: string         (required)                     â”‚   â”‚
â”‚  â”‚    purpose?: string                                     â”‚   â”‚
â”‚  â”‚    message?: string                                     â”‚   â”‚
â”‚  â”‚    submittedAt: string                                  â”‚   â”‚
â”‚  â”‚    source: string                                       â”‚   â”‚
â”‚  â”‚  }                                                       â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Processing:                                            â”‚   â”‚
â”‚  â”‚  1. Validate required fields                            â”‚   â”‚
â”‚  â”‚  2. Check email format                                  â”‚   â”‚
â”‚  â”‚  3. Check phone (10+ digits)                            â”‚   â”‚
â”‚  â”‚  4. Save to database (TODO)                             â”‚   â”‚
â”‚  â”‚  5. Send confirmation email (TODO)                      â”‚   â”‚
â”‚  â”‚  6. Notify team (TODO)                                  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Response Body:                                         â”‚   â”‚
â”‚  â”‚  {                                                       â”‚   â”‚
â”‚  â”‚    success: boolean                                     â”‚   â”‚
â”‚  â”‚    message: string                                      â”‚   â”‚
â”‚  â”‚    leadId?: string                                      â”‚   â”‚
â”‚  â”‚    lead: LeadData                                       â”‚   â”‚
â”‚  â”‚  }                                                       â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ External Services (Future)
              â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚          â”‚              â”‚              â”‚             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
    â”‚Databaseâ”‚  â”‚  Email â”‚  â”‚  CRM      â”‚  â”‚ Slack  â”‚     â”‚Analyticsâ”‚
    â”‚        â”‚  â”‚Service â”‚  â”‚(HubSpot)  â”‚  â”‚Webhook â”‚     â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Sequence

```
USER INPUT
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatBotRefactored (Component)                         â”‚
â”‚ - Captures user text input                            â”‚
â”‚ - Validates not empty                                 â”‚
â”‚ - Disables send button                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useChatStateMachine Hook                              â”‚
â”‚ - processUserMessage(userInput)                       â”‚
â”‚ - addMessage(userInput, "user", currentStage)        â”‚
â”‚ - extractLeadData(userInput)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ lead-validation.ts                                     â”‚
â”‚ - extractLeadData()                                   â”‚
â”‚   - extractEmail(text)                               â”‚
â”‚   - extractPhone(text)                               â”‚
â”‚   - extractName(text)                                â”‚
â”‚   - detectPurpose(text)                              â”‚
â”‚ Returns: Partial<LeadData>                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useChatStateMachine Hook                              â”‚
â”‚ - Merge extracted data: leadData â† extractedData     â”‚
â”‚ - setLeadData(updatedLeadData)                       â”‚
â”‚ - validateForStage(nextStage, updatedLeadData)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
            â”Œâ”€â”€â”€â”´â”€â”€â”€â”
            â”‚ Valid?â”‚
            â””â”€â”€â”€â”¬â”€â”€â”€â”˜
         Yes   â”‚    No
            â”Œâ”€â”€â”´â”€â”€â”
            â”‚     â”‚
        â”Œâ”€â”€â”€â–¼â”€â”€â” â”‚
        â”‚ Show â”‚ â”‚
        â”‚Error â”‚ â”‚
        â”‚Returnâ”‚ â”‚
        â””â”€â”€â”€â”€â”€â”€â”˜ â”‚
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Advance Stage                     â”‚ â”‚
â”‚ setCurrentStage(nextStage)        â”‚ â”‚
â”‚ saveChatState() â†’ localStorage    â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â†“                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Fetch AI Response                 â”‚ â”‚
â”‚ POST /api/chat                    â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚ API Handler            â”‚    â”‚
        â”‚ 1. Trim history        â”‚    â”‚
        â”‚ 2. Build context       â”‚    â”‚
        â”‚ 3. Call OpenAI         â”‚    â”‚
        â”‚ 4. Return reply        â”‚    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚ OpenAI API             â”‚    â”‚
        â”‚ gpt-3.5-turbo          â”‚    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚ Response: {reply, ...} â”‚    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                â”‚                      â”‚
                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useChatStateMachine Hook (Continue)                   â”‚
â”‚ - addMessage(botReply, "bot", nextStage)             â”‚
â”‚ - setIsLoading(false)                                â”‚
â”‚ - lastBotMessageRef.current = botReply               â”‚
â”‚ - saveChatState(leadData, messages)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatBotRefactored (Component)                         â”‚
â”‚ - Update UI with bot message                         â”‚
â”‚ - Scroll to bottom                                    â”‚
â”‚ - Show typing indicator                              â”‚
â”‚ - Enable send button                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ All Data Collected?   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           Yes  â”‚  No
             â”Œâ”€â”€â”´â”€â”€â”
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â” â”‚
        â”‚ Show  â”‚ â”‚
        â”‚Summaryâ”‚ â”‚ Continue to next input
        â”‚  +    â”‚ â”‚
        â”‚  CTA  â”‚ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ (Loop back to USER INPUT)
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ User clicks "Continue to Contact Form"
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useChatStateMachine Hook                              â”‚
â”‚ - advanceToContactForm()                              â”‚
â”‚ - Build URL: /contact?name=...&email=...&phone=...   â”‚
â”‚ - setCurrentStage(COMPLETE)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatBotRefactored (Component)                         â”‚
â”‚ - router.push(contactUrl)                            â”‚
â”‚ - Navigate to contact page                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ContactAutofill (Component)                           â”‚
â”‚ - useSearchParams()                                   â”‚
â”‚ - Read: name, email, phone, purpose                  â”‚
â”‚ - setFormData(pre-filled values)                      â”‚
â”‚ - Show "Pre-filled" notification                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Reviews & Submits Form                           â”‚
â”‚ - Click "Send Message"                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ContactAutofill (Component)                           â”‚
â”‚ - handleSubmit()                                      â”‚
â”‚ - Validate required fields                           â”‚
â”‚ - setIsSubmitting(true)                              â”‚
â”‚ - POST /api/lead                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Handler: POST /api/lead                           â”‚
â”‚ - Validate lead data                                  â”‚
â”‚ - Check email format                                 â”‚
â”‚ - Check phone length                                 â”‚
â”‚ - Log lead (TODO: save to DB)                        â”‚
â”‚ - Return 201 + lead object                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ContactAutofill (Component)                           â”‚
â”‚ - setIsSubmitted(true)                               â”‚
â”‚ - Show success message                                â”‚
â”‚ - setTimeout(() => reset, 3000)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ State Shape Reference

```typescript
// types/lead.ts
interface ChatStage {
  GREETING: "GREETING"
  ASK_NAME: "ASK_NAME"
  ASK_EMAIL: "ASK_EMAIL"
  ASK_PHONE: "ASK_PHONE"
  ASK_PURPOSE: "ASK_PURPOSE"
  SUMMARY: "SUMMARY"
  COMPLETE: "COMPLETE"
}

interface LeadData {
  name?: string              // "John Doe"
  email?: string             // "john@example.com"
  phone?: string             // "+1 (555) 123-4567"
  purpose?: string           // "webapp" | "portfolio" | "ai" | ...
  timestamp?: Date           // Date object
  conversationLength?: number // 5
}

interface ChatMessage {
  id: string                 // "msg_123"
  text: string               // "Hi, I'm John"
  sender: "user" | "bot"     // "user"
  timestamp: Date            // new Date()
  stage?: ChatStage          // "ASK_NAME"
  isTyping?: boolean         // false
}

// In useChatStateMachine Hook
interface HookState {
  messages: ChatMessage[]
  leadData: LeadData
  currentStage: ChatStage
  isLoading: boolean
  isTyping: boolean
  error: string | null
}
```

---

## ğŸ” Validation Pipeline

```
User Input
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ validateEmail(email)   â”‚
â”‚ - Check not empty      â”‚
â”‚ - Regex: standard      â”‚
â”‚ - Return: { valid, error }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ validatePhone(phone)   â”‚
â”‚ - Check not empty      â”‚
â”‚ - Count digits: 10+    â”‚
â”‚ - Return: { valid, error }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ validateName(name)     â”‚
â”‚ - Check not empty      â”‚
â”‚ - Check length: 2+     â”‚
â”‚ - Return: { valid, error }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ validateForStage()     â”‚
â”‚ - Switch on stage      â”‚
â”‚ - Apply rules          â”‚
â”‚ - Return: { valid, error }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”œâ”€ Valid? â†’ Advance stage
    â””â”€ Invalid? â†’ Show error, stay on stage
```

---

## ğŸ“± Component Hierarchy

```
App Layout
â”œâ”€â”€ Navbar
â”œâ”€â”€ Hero
â”œâ”€â”€ Services
â”œâ”€â”€ FeaturedProject
â”œâ”€â”€ Impact
â”‚
â”œâ”€â”€ ChatBotRefactored
â”‚   â”œâ”€â”€ Floating Button
â”‚   â”‚   â””â”€â”€ Message Indicator
â”‚   â”‚
â”‚   â””â”€â”€ Chat Window (when open)
â”‚       â”œâ”€â”€ Header (with progress)
â”‚       â”‚   â””â”€â”€ Progress Bar
â”‚       â”‚
â”‚       â”œâ”€â”€ Messages Container
â”‚       â”‚   â”œâ”€â”€ User Messages
â”‚       â”‚   â”œâ”€â”€ Bot Messages
â”‚       â”‚   â””â”€â”€ Typing Indicator
â”‚       â”‚
â”‚       â”œâ”€â”€ Summary Display (when stage === SUMMARY)
â”‚       â”‚   â””â”€â”€ CTA Button
â”‚       â”‚
â”‚       â””â”€â”€ Input Form (unless COMPLETE)
â”‚           â”œâ”€â”€ Input Field
â”‚           â””â”€â”€ Send Button
â”‚
â”œâ”€â”€ ContactAutofill
â”‚   â”œâ”€â”€ Header
â”‚   â”œâ”€â”€ Auto-fill Notification
â”‚   â”œâ”€â”€ Form Section
â”‚   â”‚   â”œâ”€â”€ Name Input
â”‚   â”‚   â”œâ”€â”€ Email Input
â”‚   â”‚   â”œâ”€â”€ Phone Input
â”‚   â”‚   â”œâ”€â”€ Project Type Select
â”‚   â”‚   â”œâ”€â”€ Message Textarea
â”‚   â”‚   â””â”€â”€ Submit Button
â”‚   â”‚
â”‚   â””â”€â”€ Contact Info Section
â”‚       â”œâ”€â”€ Email Card
â”‚       â”œâ”€â”€ LinkedIn Card
â”‚       â”œâ”€â”€ GitHub Card
â”‚       â””â”€â”€ Twitter Card
â”‚
â””â”€â”€ Footer
```

---

## ğŸ—„ï¸ Data Persistence

```
Conversation Flow
    â†“
Each Stage Completion
    â†“
saveChatState()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage.setItem()          â”‚
â”‚ Key: "dark_nebula_lead"         â”‚
â”‚                                 â”‚
â”‚ Value: {                        â”‚
â”‚   leadData: LeadData,           â”‚
â”‚   currentStage: ChatStage,      â”‚
â”‚   messageCount: number,         â”‚
â”‚   timestamp: ISO string         â”‚
â”‚ }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Page Reload
    â†“
useEffect on component mount
    â†“
loadChatState()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage.getItem()          â”‚
â”‚ Key: "dark_nebula_lead"         â”‚
â”‚ â†“                               â”‚
â”‚ Restore state from JSON         â”‚
â”‚ Resume conversation at same     â”‚
â”‚ stage with same lead data       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagram Generated:** State Machine Chatbot System Architecture
**Version:** 1.0
**Status:** Production Ready
